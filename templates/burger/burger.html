{% extends 'burger/base.html' %}
{% load staticfiles %}
{% block title %}{{burger.name}}{% endblock %}

{% block body_block %}
<script src="{% static 'galleria-1.4.2.min.js'%}"></script>
<h1>{{ burger.name }}</h1>
<div class="{{burger.slug}}_image burger_images galleria"></div>
{% if burger %}
    <div id="review">
    {% if reviews %}
    <ul>
        {% for comment in reviews %}
            {{comment.text}}<br>
            {{comment.user.username}}<br>
            {% if comment.user.picture %}
                <img src="{{ MEDIA_URL }}{{comment.user.picture}}"/>
            {% endif %}
            {{comment.date}}<br>
        {% endfor %}
    </ul>
    {% else %}
       <center> <strong>No review currently in {{burger.name}}.</strong></center><br>
    {% endif %}
    </div>
    {% if user.is_authenticated %}
    {# <a href="{% url 'add_burger_review' slug%}">Add a New Review</a><br /> #}
    <center><form id="review_form" method="post" class="form-group" action="{% url 'burger_page' slug%}">

        {% csrf_token %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}

        {% for field in form.visible_fields %}
            {{ field.errors }}
            {{ field.help_text }} <br/>
            {{ field }}
            <br>
            {{picture_form}}
        {% endfor %}

       <input type="submit" name="submit" class="btn btn-primary btn-lg btn-block" value="Submit Review" /></center>
    </form>

    <script type="text/javascript">
        var form = $('#review_form');
        ajaxForm(
            form,
            function(json) {
                $('#id_text').val('');
                console.log(json.result);
                if (json.result === 'success') {
                    $('#review').html("");
                    $('#review').append(json.reviews);
                }
            },
            function(xhr,errmsg,err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        );
    </script>
    {% endif%}
<script type="text/javascript">
    getImages(
        "{{burger.slug}}",
        function(json) {
            if (json.urls.length > 0) {
                for (var idx in json.urls) {
                    $("."+json.slug + "_image").append("<img src='"+json.urls[idx]+"'>");
                }
                Galleria.loadTheme("{% static 'galleria.classic.min.js' %}");
                Galleria.run('.burger_images');
            }
        }
    );
</script>
{% else %}
    The specified burger {{ burger.name }} does not exist!
{% endif %}

{% endblock %}