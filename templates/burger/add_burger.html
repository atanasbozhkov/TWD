{% extends 'burger/base.html' %}

{% block title %}Add Burger{% endblock %}

{% block body_block %}


    <div class="span12 pagination-centered" style="text-align:center;">
     <h2> Add new burger</h2>
     
     <form id="category_form" method="post" action="{% url 'add_burger' %}" enctype="multipart/form-data">

        {% csrf_token %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}

        {% for field in form.visible_fields %}
            {{ field.errors }}
            {{ field.help_text }}
            {{ field }}
            <br>
        {% endfor %}

            <input type="submit" name="submit" value="Add Burger" />
        </form>
    </div>
    <div id="results"></div>

    <script type="text/javascript">
        $('#id_location').after("<br><span class='redirect_link'><p>cannot find the restaurant location?</p><a href='{% url 'add_place' %}' >Add It Now!</a></span>")
    </script>

    {% if user.is_superuser %}
    <form id='category_add' action="{% url 'add_burger_category' %}">
        {% csrf_token %}
        <input id='burger_cat_name' maxlength='128' name='name' type='text'>
        <input type='submit' name='submit' value='Add Burger Category' />
    </form>
    
    <script type="text/javascript">
        var form = $('#category_add');
        ajaxForm(
            form,
            function(json) {
                $('#burger_cat_name').val('');
                console.log(json);
                console.log(json.result);
                if (json.result === 'created') {
                    var categorySelect = $(json.form).find('#id_category');
                    $("#id_category").html("");
                    $("#id_category").append(categorySelect.find('option'));
                }
            },
            function(xhr,errmsg,err) {
                $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                    " <a href='#' class='close'>&times;</a></div>");
                console.log(xhr.status + ": " + xhr.responseText);
            }
        );
    </script>
    {% endif %}
{% endblock %}